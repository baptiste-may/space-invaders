name: Makefile CI

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Code Checkout
        uses: actions/checkout@v4
    
      - name: Install dependancies
        run: |
          sudo apt-get update
          sudo apt-get install build-essential git make \
            pkg-config cmake ninja-build gnome-desktop-testing libasound2-dev libpulse-dev \
            libaudio-dev libfribidi-dev libjack-dev libsndio-dev libx11-dev libxext-dev \
            libxrandr-dev libxcursor-dev libxfixes-dev libxi-dev libxss-dev libxtst-dev \
            libxkbcommon-dev libdrm-dev libgbm-dev libgl1-mesa-dev libgles2-mesa-dev \
            libegl1-mesa-dev libdbus-1-dev libibus-1.0-dev libudev-dev libpipewire-0.3-dev \
            libwayland-dev libdecor-0-dev liburing-dev libfreetype6-dev libharfbuzz-dev \
            libjpeg-dev libpng-dev libtiff-dev libwebp-dev
    
      - name: Install SDL3
        run: |
          cd /tmp
          git clone --depth 1 https://github.com/libsdl-org/SDL.git SDL3
          cd SDL3
          mkdir build
          cd build
          cmake .. -DCMAKE_BUILD_TYPE=Release
          make -j$(nproc)
          sudo make install
          sudo ldconfig

      - name: Install SDL3_image
        run: |
          cd /tmp
          git clone --depth 1 https://github.com/libsdl-org/SDL_image.git SDL3_image
          cd SDL3_image
          mkdir build
          cd build
          cmake .. -DCMAKE_BUILD_TYPE=Release
          make -j$(nproc)
          sudo make install
          sudo ldconfig

      - name: Install SDL3_ttf
        run: |
          cd /tmp
          git clone --depth 1 https://github.com/libsdl-org/SDL_ttf.git SDL3_ttf
          cd SDL3_ttf
          mkdir build
          cd build
          cmake .. -DCMAKE_BUILD_TYPE=Release
          make -j$(nproc)
          sudo make install
          sudo ldconfig
    
      - name: Test with make
        run: make
